# Scoop tssh 加密增强安装器

这是一个用于增强 Scoop 安装的 tssh 工具的 PowerShell 脚本，主要功能是为 tssh 配置文件添加 GPG 加密保护，提高 SSH 连接配置的安全性。

## 功能特性

- **自动加密配置文件**：使用 GPG 对 tssh 配置文件进行 AES256 加密
- **透明解密**：运行 tssh 时自动解密配置文件，用户无感知
- **安全清理**：解密后的配置文件会在使用后自动删除
- **智能路径检测**：自动检测 Scoop 和 tssh 的安装路径
- **完整备份**：安装前自动备份原始程序，支持完全重置

## 系统要求

- Windows PowerShell 5.1 或 PowerShell 7+
- Scoop 包管理器
- 已安装的 tssh 工具（通过 Scoop 安装）

## 使用方法

### 安装加密增强功能

```powershell
.\setup-tssh-encryption.ps1 -Install
```

安装过程会：
1. 自动安装依赖工具（GPG、Go 编译器）
2. 备份原始 tssh 程序
3. 生成或使用现有 GPG 密钥对配置文件进行加密
4. 编译并部署 Go 包装程序
5. 配置 GPG 代理缓存设置

### 重置到原始状态

```powershell
.\setup-tssh-encryption.ps1 -Reset
```

重置过程会：
1. 删除所有增强功能相关文件
2. 恢复原始 tssh 程序
3. 重新安装 tssh 确保 shim 正确

### 显示帮助信息

```powershell
.\setup-tssh-encryption.ps1
```

## 工作原理

1. **配置加密**：脚本使用 GPG 对 `~/.ssh/config` 文件进行 AES256 加密
2. **包装程序**：生成 Go 语言编写的包装程序替换原始 tssh.exe
3. **透明解密**：运行 tssh 时，包装程序自动解密配置文件到临时位置
4. **安全清理**：tssh 读取配置后，包装程序立即删除解密的临时文件
5. **密码缓存**：GPG 代理缓存密码，避免重复输入

## 安全特性

- **AES256 加密**：使用军用级别的加密算法保护配置文件
- **内存中处理**：解密过程在内存中完成，减少磁盘暴露
- **自动清理**：临时解密文件在使用后立即删除
- **密码缓存**：GPG 代理提供 8 小时密码缓存，平衡安全性和便利性

## 文件结构

安装后会在 tssh 目录中创建以下文件：
- `tssh-original.exe` - 原始 tssh 程序备份
- `tssh.exe` - 加密增强的包装程序
- `~/.ssh/config.gpg` - 加密的配置文件

## 故障排除

### 找不到 Scoop 安装
确保 Scoop 已正确安装，脚本会检查以下位置：
- `%USERPROFILE%\scoop`
- `%ProgramData%\scoop`
- `D:\scoop-global`
- `C:\scoop`

### GPG 密钥问题
首次使用时会提示生成 GPG 密钥，请：
1. 选择合适的密钥类型（推荐 RSA）
2. 设置强密码
3. 填写用户信息

### 编译失败
确保系统已安装 Go 编译器，脚本会自动通过 Scoop 安装。

## 注意事项

- 首次运行需要输入 GPG 密码
- 密码会缓存 8 小时，之后需要重新输入
- 重置操作会完全移除加密功能
- 建议在安装前备份重要的 SSH 配置

## 许可证

本脚本仅供学习和个人使用，请遵守相关法律法规。
